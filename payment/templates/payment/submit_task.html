{% extends "base.html" %}
{% load static %}

{% block title %}Submit Task | SkillBridge{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #4361ee;
        --secondary-color: #3f37c9;
        --accent-color: #4895ef;
        --light-bg: #f8f9fa;
        --dark-bg: #212529;
    }

    main {
        padding-top: 1.5rem;
        background-color: var(--light-bg);
        min-height: 100vh;
    }

    .section-card {
        border: none;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
        transition: all 0.3s ease;
    }

    .section-card:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    }

    .section-card .card-header {
        background: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        border-radius: 12px 12px 0 0 !important;
        padding: 1.25rem 1.5rem;
    }

    .form-control, .form-control-file {
        border-radius: 8px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-control-file:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        transform: translateY(-2px);
    }

    .btn-outline-secondary {
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .btn-outline-secondary:hover {
        background-color: var(--light-bg);
        transform: translateY(-2px);
    }

    .task-details {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }

    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }

    @media (max-width: 768px) {
        main {
            padding-top: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Main Content -->
        <main class="col-12 px-md-4">
            <div class="section-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h2 class="h3 mb-0">
                        <i class="bi bi-files me-2"></i> Submit Task
                    </h2>
                    <a href="{% url 'jobs:student_dashboard' %}" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i> Back to Dashboard
                    </a>
                </div>
                <div class="card-body">
                    <!-- Task Details -->
                    <div class="task-details">
                        <h5>{{ task.application.job.title }}</h5>
                        <p class="text-muted mb-2">
                            <strong>Employer:</strong> {{ task.application.job.employer.company_name }}
                        </p>
                        <p class="mb-2">
                            <strong>Task Description:</strong> {{ task.task_description|linebreaksbr }}
                        </p>
                        <p class="mb-0">
                            <strong>Due Date:</strong> {{ task.due_date|date:"M d, Y"|default:"N/A" }}
                        </p>
                    </div>

                    <!-- Messages -->
                    {% if messages %}
                    <div class="mb-4">
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <!-- Submission Form -->
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="id_description" class="form-label">Submission Description</label>
                            {{ form.description }}
                            <div class="invalid-feedback">
                                Please provide a description for your submission.
                            </div>
                            <small class="form-text text-muted">
                                Describe your work, including any relevant details (e.g., tools used, approach taken).
                            </small>
                        </div>
                        <div class="mb-3">
                            <label for="id_work_file" class="form-label">Upload File</label>
                            {{ form.work_file }}
                            <div class="invalid-feedback">
                                Please upload a file for your submission.
                            </div>
                            <small class="form-text text-muted">
                                Supported formats: PDF, DOCX, ZIP, etc. (Max size: 10MB)
                            </small>
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <a href="{% url 'jobs:student_dashboard' %}" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-primary" data-bs-toggle="tooltip" title="Submit your task for review">
                                <i class="bi bi-upload me-1"></i> Submit Task
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

    // Form validation
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });
});
</script>
{% endblock %}